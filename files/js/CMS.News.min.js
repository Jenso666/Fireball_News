if(!CMS)var CMS={};CMS.News={};CMS.News.Image={};CMS.News.Image.Form=Class.extend({_cache:[],_dialog:null,_didInit:false,_button:null,_proxy:null,_field:null,init:function(a,b){this._button=a;this._field=b;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._button.click($.proxy(this._click,this))},_click:function(a){a.preventDefault();var b=$(a.currentTarget);this.button=b;if(this._dialog==null){this._dialog=$('<div id="newsImages" />').appendTo(document.body);this._proxy.setOption("data",{actionName:"getImages",className:"cms\\data\\news\\image\\NewsImageAction",parameters:{imageID:this._field.val()}});this._proxy.sendRequest()}else this._dialog.wcfDialog("open")},_success:function(a){if(this.didInit){this.dialog.find("#newsImages").html(a.returnValues.template);this._dialog.wcfDialog("render")}else{this._dialog.html(a.returnValues.template);this._dialog.wcfDialog({title:WCF.Language.get("cms.news.image.select")});upload=new CMS.News.Image.Upload;this._didInit=true}this._dialog.find(".jsNewsImage").click($.proxy(this._imageSelect,this));this._dialog.find('.jsNewsImage[data-object-id="'+this._field.val()+'"]').addClass("active")},_imageSelect:function(b){var a=$(b.currentTarget);this._field.val(a.data("objectID"));a.clone().appendTo($(".newsImageSelect ul").html(""));this._dialog.wcfDialog("close")}});CMS.News.Image.Upload=WCF.Upload.extend({init:function(){this._super($("#imageUploadButton"),$(".imageUpload ul"),"cms\\data\\news\\image\\NewsImageAction")},_initFile:function(b){this._fileListSelector.children("li").remove();var a=$('<li class="box32"><span class="icon icon32 icon-spinner" /><div><div><p>'+b.name+'</p><small><progress max="100"></progress></small></div></div></li>');this._fileListSelector.append(a);this._fileListSelector.show();return a},_success:function(d,b){var a=this._fileListSelector.find("li");a.find("progress").remove();if(b.returnValues.imageID){a.children(".icon-spinner").remove();a.prepend('<div class="framed"><img src="'+b.returnValues.url+'" alt="" style="width: 32px; max-height: 32px" /></div>');$('<div class="framed"><img src="'+b.returnValues.url+'" alt="" style="width: 32px; max-height: 32px" /></div>').appendTo($(".newsImageSelect ul").html(""));$("#imageID").val(b.returnValues.imageID);var c=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));c.show()}else{a.children(".icon-spinner").removeClass("icon-spinner").addClass("icon-ban-circle");a.find("div > div").append($('<small class="innerError">'+WCF.Language.get("cms.news.image.error."+b.returnValues.errorType)+"</small>"));a.addClass("uploadFailed")}a.css("display","block");WCF.DOMNodeInsertedHandler.execute()},_error:function(){var a=this._fileListSelector.find("li");a.addClass("uploadFailed").children(".icon-spinner").removeClass("icon-spinner").addClass("icon-ban-circle");a.find("div > div").append($('<small class="innerError">'+WCF.Language.get("cms.news.image.error.uploadFailed")+"</small>"))}});CMS.News.MarkAllAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".markAllAsReadButton").click($.proxy(this._click,this))},_click:function(){this._proxy.setOption("data",{actionName:"markAllAsRead",className:"cms\\data\\news\\NewsAction"});this._proxy.sendRequest()},_success:function(){$("#mainMenu .active .badge").hide();$(".newMessageBadge").hide()}});CMS.News.Preview=WCF.Popover.extend({_proxy:null,_newss:{},init:function(){this._super(".newsLink");this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false});WCF.DOMNodeInsertedHandler.addCallback("CMS.News.Preview",$.proxy(this._initContainers,this))},_loadContent:function(){var b=$("#"+this._activeElementID);this._proxy.setOption("data",{actionName:"getNewsPreview",className:"cms\\data\\news\\NewsAction",objectIDs:[b.data("newsID")]});var a=this._activeElementID,c=this;this._proxy.setOption("success",function(b){c._insertContent(a,b.returnValues.template,true)});this._proxy.sendRequest()}});CMS.News.Like=WCF.Like.extend({_getContainers:function(){return $("article.message")},_getObjectID:function(a){return this._containers[a].data("newsID")},_buildWidget:function(a,e,d,g,b){var f=this._getWidgetContainer(a);if(this._canLike){var c=this._containers[a].find(".smallButtons");e.insertBefore(c.find(".toTopLink"));d.insertBefore(c.find(".toTopLink"));d.find("a").addClass("button");e.find("a").addClass("button")}if(b){b.appendTo(this._containers[a].find(".messageBody > .messageFooter"));b.addClass("messageFooterNote")}f.find(".permalink").after(g)},_getWidgetContainer:function(a){return this._containers[a].find(".messageHeader")},_addWidget:function(){},_setActiveState:function(b,a,c){b=b.find(".button").removeClass("active");a=a.find(".button").removeClass("active");if(c==1)b.addClass("active");else c==-1&&a.addClass("active")}});CMS.News.IPAddressHandler=Class.extend({_cache:{},_dialog:null,_proxy:null,init:function(){this._cache={};this._dialog=null;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._initButtons();WCF.DOMNodeInsertedHandler.addCallback("CMS.News.IPAddressHandler",$.proxy(this._initButtons,this))},_initButtons:function(){var a=this;$(".jsIpAddress").each(function(e,d){var b=$(d),c=b.data("newsID");if(a._cache[c]===undefined){a._cache[c]="";b.click($.proxy(a._click,a))}})},_click:function(b){var a=$(b.currentTarget).data("newsID");if(this._cache[a])this._showDialog(a);else{this._proxy.setOption("data",{actionName:"getIpLog",className:"cms\\data\\news\\NewsAction",parameters:{newsID:a}});this._proxy.sendRequest()}},_success:function(a){this._cache[a.returnValues.newsID]=a.returnValues.template;this._showDialog(a.returnValues.newsID)},_showDialog:function(a){if(this._dialog===null)this._dialog=$('<div id="newsIpAddressLog" />').hide().appendTo(document.body);this._dialog.html(this._cache[a]);this._dialog.wcfDialog({title:WCF.Language.get("cms.news.ipAddress.title")});this._dialog.wcfDialog("render")}})